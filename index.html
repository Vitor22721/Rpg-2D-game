<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>üî• RPG √âpico - Ascens√£o Elemental</title>
  <style>
    body { 
      background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); 
      color: #e0e0ff; font-family: 'Segoe UI', sans-serif; 
      text-align: center; margin: 0; padding: 10px;
    }
    canvas { 
      background: linear-gradient(to bottom, #a1c4fd 0%, #c2e9fb 40%, #d4fc79 100%); 
      border: 5px solid #ffcc00; border-radius: 15px; 
      box-shadow: 0 0 25px #ffcc00aa; display: block; margin: 15px auto;
    }
    button { 
      padding: 9px 16px; margin: 5px; font-weight: bold; font-size: 1em;
      background: linear-gradient(#4e54c8, #8f94fb); color: white; border: none; 
      border-radius: 10px; cursor: pointer; transition: all 0.2s;
    }
    button:hover { transform: scale(1.07); box-shadow: 0 0 15px #ffcc00; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    #hud, #inventario, #acoes, #loja, #log, #saveHud { margin: 12px auto; max-width: 1000px; }
    #saveHud button { background: linear-gradient(#2c3e50, #34495e); font-size: 0.9em; }
    #log div { 
      background: rgba(20,20,60,0.7); border-left: 5px solid #ffcc00; 
      margin: 6px; padding: 8px 12px; border-radius: 8px; font-size: 0.95em;
    }
    .epico { color: #ff69b4; font-weight: bold; text-shadow: 0 0 8px #ff69b4; }
    .destaque { color: #ffd700; font-weight: bold; }
    .fogo   { color: #ff4500; }
    .gelo   { color: #00b7eb; }
    .raio   { color: #ffff00; }
    .terra  { color: #8b4513; }
  </style>
</head>
<body>

  <h1>üî• <span class="epico">RPG √âpico - Ascens√£o Elemental</span> üî•</h1>

  <div id="saveHud">
    <button onclick="salvarJogo()">üíæ Salvar Jogo</button>
    <button onclick="carregarJogo()">üìÇ Carregar Jogo</button>
    <button onclick="novoJogo()">üÜï Novo Jogo</button>
  </div>

  <canvas id="game" width="800" height="480"></canvas>

  <div id="hud">
    ‚ù§Ô∏è <span id="vida">100%</span> | 
    üîÆ <span id="mana">80</span> | 
    üõ°Ô∏è <span id="defesa">8</span> | 
    ‚≠ê N√≠vel <span id="nivel">1</span> | 
    XP <span id="xp">0</span> | 
    üí∞ <span id="moedas">30</span> | 
    Elemento: <span id="elemento">-</span>
  </div>

  <div id="inventario">
    üéí <b>Invent√°rio:</b> 
    <span id="pocoes">4 po√ß√µes</span> | 
    <span id="espada">Espada ‚ùå</span> | 
    <span id="armadura">Armadura ‚ùå</span> | 
    <span id="anel">Anel ‚ùå</span> | 
    <span id="cajado">Cajado ‚ùå</span> | 
    <span id="amuleto">Amuleto ‚ùå</span> | 
    <span id="botas">Botas ‚ùå</span> | 
    <span id="orbe">Orbe ‚ùå</span> | 
    <span id="capa">Capa ‚ùå</span> | 
    <span id="coroa">Coroa ‚ùå</span>
  </div>

  <div id="acoes">
    <button onclick="acao('atacar')">‚öîÔ∏è Atacar</button>
    <div id="magiasContainer"></div>
    <button onclick="acao('usarPocao')">üß™ Po√ß√£o</button>
    <button onclick="abrirLoja()">üõí Loja</button>
  </div>

  <div id="loja" style="display:none; background:rgba(30,30,80,0.9); padding:20px; border-radius:12px; max-width:1000px; margin:20px auto;">
    <h3 class="epico">üõçÔ∏è LOJA M√çSTICA</h3>
    <button onclick="comprar('pocao')">üß™ Po√ß√£o (6 üí∞)</button>
    <button onclick="comprar('espada')">üó°Ô∏è Espada Flamejante (24 üí∞)</button>
    <button onclick="comprar('armadura')">üõ°Ô∏è Armadura do Guardi√£o (32 üí∞)</button>
    <button onclick="comprar('anel')">üíç Anel do Arcanista (38 üí∞)</button>
    <button onclick="comprar('cajado')">üîÆ Cajado do Caos (45 üí∞)</button>
    <button onclick="comprar('amuleto')">ü™¨ Amuleto da Vida (40 üí∞)</button>
    <button onclick="comprar('botas')">üë¢ Botas do Vento (35 üí∞)</button>
    <button onclick="comprar('orbe')">üåå Orbe do Caos (80 üí∞)</button>
    <button onclick="comprar('capa')">üß• Capa da Sombra (50 üí∞)</button>
    <button onclick="comprar('coroa')">üëë Coroa do Conquistador (65 üí∞)</button>
    <br><button onclick="fecharLoja()" style="margin-top:15px; background:#e94560;">‚ùå Fechar Loja</button>
  </div>

  <div id="log"></div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let jogador, personagem, inimigo, gameOver = false;
    let flashPlayer = 0, flashEnemy = 0;
    let particulas = [];

    // =============================================
    // ELEMENTOS e magias (mantidos)
    // =============================================
    const elementos = [
      { nome: "Fogo", cor: "fogo", magias: [
        {nome: "Bola de Fogo", custo:15, danoBase:35, nivelMin:1},
        {nome: "Chamas Eternas", custo:20, danoBase:45, nivelMin:3},
        {nome: "Explos√£o Vulc√¢nica", custo:28, danoBase:65, nivelMin:6},
        {nome: "Meteoro Flamejante", custo:38, danoBase:90, nivelMin:10},
        {nome: "Inferno Vivo", custo:50, danoBase:140, nivelMin:14}
      ]},
      { nome: "Gelo", cor: "gelo", magias: [
        {nome: "Raio de Gelo", custo:16, danoBase:38, nivelMin:1},
        {nome: "N√©voa Glacial", custo:19, danoBase:30, nivelMin:3},
        {nome: "Pris√£o de Gelo", custo:25, danoBase:50, nivelMin:6},
        {nome: "Tempestade de Granizo", custo:34, danoBase:75, nivelMin:10},
        {nome: "Era do Gelo", custo:48, danoBase:120, nivelMin:14}
      ]},
      { nome: "Raio", cor: "raio", magias: [
        {nome: "Raio Simples", custo:18, danoBase:45, nivelMin:1},
        {nome: "Corrente El√©trica", custo:23, danoBase:55, nivelMin:3},
        {nome: "Explos√£o de Trov√£o", custo:30, danoBase:70, nivelMin:6},
        {nome: "Tempestade de Raios", custo:42, danoBase:100, nivelMin:10},
        {nome: "Julgamento El√©trico", custo:55, danoBase:160, nivelMin:14}
      ]},
      { nome: "Terra", cor: "terra", magias: [
        {nome: "Espinhos Venenosos", custo:17, danoBase:40, nivelMin:1},
        {nome: "Terremoto Leve", custo:22, danoBase:50, nivelMin:3},
        {nome: "Muralha de Pedra", custo:26, danoBase:0, nivelMin:6},
        {nome: "Fenda Tect√¥nica", custo:36, danoBase:85, nivelMin:10},
        {nome: "Ira da Natureza", custo:52, danoBase:130, nivelMin:14}
      ]}
    ];

    function rolarD4() { return Math.floor(Math.random() * 4); }

    function criarPersonagem() {
      let nome = prompt("Nome do seu her√≥i:") || "Her√≥i Sem Nome";

      let racaOpt = prompt(
        "Ra√ßa (1-10):\n1-Humano 2-Elfo 3-An√£o 4-Orc 5-Vampiro 6-Gnomo 7-Tiefling 8-Draconato 9-Centauro 10-Tabaxi"
      ) || "1";

      let classeOpt = prompt(
        "Classe (1-10):\n1-Guerreiro 2-Mago 3-Paladino 4-Necromante 5-Ladino 6-Arqueiro 7-B√°rbaro 8-Feiticeiro 9-Samurai 10-Invocador"
      ) || "1";

      const racas = ["Humano","Elfo","An√£o","Orc","Vampiro","Gnomo","Tiefling","Draconato","Centauro","Tabaxi"];
      const classes = ["Guerreiro","Mago","Paladino","Necromante","Ladino","Arqueiro","B√°rbaro","Feiticeiro","Samurai","Invocador"];

      let raca   = racas[parseInt(racaOpt)-1]   || "Humano";
      let classe = classes[parseInt(classeOpt)-1] || "Guerreiro";

      let elementoIndex = rolarD4();
      let elemento = elementos[elementoIndex];

      alert(`1d4 rolado ‚Üí ${elementoIndex+1}\nElemento escolhido: ${elemento.nome.toUpperCase()}`);

      let attr = { forca:6, magia:6, agilidade:6, vida:65, regen:0, critico:0, defesaExtra:0, iniciativa:0 };

      // Ra√ßas
      if (raca === "Humano")      { attr.forca +=2; attr.magia +=2; attr.agilidade +=2; }
      if (raca === "Elfo")        { attr.agilidade +=5; attr.magia +=4; }
      if (raca === "An√£o")        { attr.forca +=6; attr.vida +=30; attr.defesaExtra +=4; }
      if (raca === "Orc")         { attr.forca +=8; attr.vida +=35; attr.regen = 4; }
      if (raca === "Vampiro")     { attr.agilidade +=5; attr.regen = 10; attr.critico = 0.18; }
      if (raca === "Gnomo")       { attr.magia +=6; attr.critico = 0.22; }
      if (raca === "Tiefling")    { attr.magia +=7; attr.regen = 3; }
      if (raca === "Draconato")   { attr.forca +=5; attr.magia +=4; attr.vida +=20; }
      if (raca === "Centauro")    { attr.forca +=4; attr.vida +=25; attr.iniciativa = 5; }
      if (raca === "Tabaxi")      { attr.agilidade +=5; attr.critico +=0.15; attr.esquivaExtra = 0.20; }

      // Classes
      if (classe === "Guerreiro") attr.forca +=7;
      if (classe === "Mago")      attr.magia +=10;
      if (classe === "Paladino")  { attr.defesaExtra +=12; attr.magia +=5; }
      if (classe === "Necromante"){ attr.magia +=11; attr.regen +=5; }
      if (classe === "Ladino")    { attr.agilidade +=9; attr.critico +=0.28; }
      if (classe === "Arqueiro")  attr.agilidade +=10;
      if (classe === "B√°rbaro")   { attr.forca +=9; attr.vida +=40; }
      if (classe === "Feiticeiro"){ attr.magia +=9; attr.critico +=0.15; }
      if (classe === "Samurai")   { attr.forca +=6; attr.defesaExtra +=10; attr.contraAtaque = 0.25; }
      if (classe === "Invocador") { attr.magia +=8; attr.manaMaxExtra = 40; }

      alert(`Her√≥i criado!\n${nome} - ${raca} ${classe}\nElemento: \( {elemento.nome}\nFor√ßa: \){attr.forca} Magia:\( {attr.magia} Vida: \){attr.vida}`);

      return { nome, raca, classe, elemento, atributos: attr };
    }

    function initJogo(reset = false) {
      if (reset) {
        personagem = criarPersonagem();
      } else if (localStorage.getItem('rpgSave')) {
        if (confirm("Carregar jogo salvo?")) {
          carregarJogo();
          return;
        }
      }

      personagem = criarPersonagem();
      jogador = {
        ...personagem,
        vidaMax: personagem.atributos.vida * 2.5,
        vida: personagem.atributos.vida * 2.5,
        manaMax: 50 + personagem.atributos.magia * 6 + (personagem.atributos.manaMaxExtra || 0),
        mana: 50 + personagem.atributos.magia * 6 + (personagem.atributos.manaMaxExtra || 0),
        nivel: 1, xp: 0, moedas: 40,
        dano: Math.floor(personagem.atributos.forca * 3.4),
        defesa: Math.floor(personagem.atributos.forca / 2) + 5 + personagem.atributos.defesaExtra,
        pocoes: 4,
        espada: false, armadura: false, anel: false, cajado: false, amuleto: false, botas: false, orbe: false, capa: false, coroa: false,
        regenPassivo: personagem.atributos.regen || 0,
        chanceCritico: personagem.atributos.critico || 0,
        esquivaExtra: personagem.atributos.esquivaExtra || 0,
        xpBonus: 1
      };

      inimigo = gerarInimigo();
      gameOver = false;
      atualizarHUD();
      atualizarBotoesMagia();
      log(`<b>A lenda de ${jogador.nome} - Mestre do ${jogador.elemento.nome} - come√ßa!</b>`);
    }

    function gerarInimigo() {
      const ehBoss = jogador.nivel % 5 === 0 && jogador.nivel >= 5;
      let fraqueza = elementos[Math.floor(Math.random()*4)].nome;

      if (ehBoss) {
        const bossNomes = ["Drag√£o de Obsidiana", "Lorde Lich", "Tit√£ Abissal", "Imperador Dem√¥nio"];
        return {
          nome: bossNomes[Math.floor(Math.random()*bossNomes.length)],
          vida: (70 + jogador.nivel * 30) * 3,
          ataque: 18 + jogador.nivel * 6,
          fraqueza: fraqueza
        };
      }

      const nomes = ["Goblin Xam√£", "Orc Berserker", "Esqueleto Guerreiro", "Lobo Alfa", "Troll das Montanhas", "Aranha Venenosa", "Bandido Capit√£o"];
      return {
        nome: nomes[Math.floor(Math.random()*nomes.length)],
        vida: 55 + jogador.nivel * 18,
        ataque: 10 + jogador.nivel * 3.2,
        fraqueza: fraqueza
      };
    }

    function log(msg) {
      const div = document.getElementById("log");
      const linha = document.createElement("div");
      linha.innerHTML = msg;
      div.prepend(linha);
      if (div.children.length > 16) div.removeChild(div.lastChild);
    }

    function playSound(freq, dur = 150, type = 'sine') {
      try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        oscillator.type = type;
        oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
        oscillator.connect(audioCtx.destination);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + dur/1000);
      } catch(e) {}
    }

    function criarParticula(x, y, cor, quantidade = 15) {
      for (let i = 0; i < quantidade; i++) {
        particulas.push({
          x: x + (Math.random()*20 - 10),
          y: y + (Math.random()*20 - 10),
          vx: Math.random()*8 - 4,
          vy: Math.random()*8 - 6,
          vida: 25 + Math.random()*15,
          cor: cor
        });
      }
    }

    function desenhar() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // C√©u + nuvens
      let grad = ctx.createLinearGradient(0,0,0,200);
      grad.addColorStop(0,"#74ebd5"); grad.addColorStop(1,"#acb6e5");
      ctx.fillStyle = grad; ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle = "rgba(255,255,255,0.85)";
      ctx.beginPath(); ctx.arc(180,90,45,0,Math.PI*2); ctx.arc(240,70,35,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(620,110,50,0,Math.PI*2); ctx.arc(680,95,38,0,Math.PI*2); ctx.fill();

      // Ch√£o
      ctx.fillStyle = "#2e7d32"; ctx.fillRect(0,360,canvas.width,canvas.height-360);

      // Part√≠culas
      particulas.forEach(p => {
        ctx.fillStyle = p.cor;
        ctx.globalAlpha = p.vida / 40;
        ctx.fillRect(p.x, p.y, 5, 5);
        p.x += p.vx;
        p.y += p.vy;
        p.vida--;
      });
      particulas = particulas.filter(p => p.vida > 0);
      ctx.globalAlpha = 1;

      // Jogador
      let corP = flashPlayer > 0 ? "#aaffaa" : "#00ff88";
      ctx.fillStyle = corP;
      ctx.fillRect(140, 380, 60, 100);
      ctx.beginPath(); ctx.arc(170, 340, 28, 0, Math.PI*2); ctx.fill();

      if (jogador.espada || jogador.orbe) {
        ctx.strokeStyle = "#ffd700"; ctx.lineWidth = 8;
        ctx.beginPath(); ctx.moveTo(200,420); ctx.lineTo(250,380); ctx.stroke();
      }

      ctx.fillStyle = "white"; ctx.font = "bold 18px Arial";
      ctx.fillText(jogador.nome.slice(0,12), 130, 320);
      ctx.fillText(Math.round(jogador.vida/jogador.vidaMax*100)+"%", 150, 500);

      // Inimigo
      let ehBoss = inimigo.nome.includes("Drag√£o") || inimigo.nome.includes("Lich") || inimigo.nome.includes("Tit√£") || inimigo.nome.includes("Dem√¥nio");
      let corE = flashEnemy > 0 ? "#ffaaaa" : (ehBoss ? "#aa0000" : "#ff5555");
      ctx.fillStyle = corE;
      ctx.fillRect(550, 370, 80, 110);
      ctx.beginPath(); ctx.arc(590, 330, 35, 0, Math.PI*2); ctx.fill();

      ctx.fillStyle = ehBoss ? "#ffcc00" : "white"; ctx.font = ehBoss ? "bold 22px Arial" : "bold 18px Arial";
      ctx.fillText(inimigo.nome, 500, 300);
      ctx.fillText("HP: "+Math.round(inimigo.vida), 540, 340);

      flashPlayer = Math.max(0, flashPlayer-2);
      flashEnemy  = Math.max(0, flashEnemy-3);

      requestAnimationFrame(desenhar);
    }

    function atualizarHUD() {
      document.getElementById("vida").textContent = Math.round(jogador.vida / jogador.vidaMax * 100) + "%";
      document.getElementById("mana").textContent = Math.round(jogador.mana);
      document.getElementById("defesa").textContent = jogador.defesa;
      document.getElementById("nivel").textContent = jogador.nivel;
      document.getElementById("xp").textContent = jogador.xp;
      document.getElementById("moedas").textContent = jogador.moedas;
      document.getElementById("elemento").textContent = jogador.elemento.nome;
      document.getElementById("pocoes").textContent = jogador.pocoes + " po√ß√µes";
      document.getElementById("espada").textContent = "Espada " + (jogador.espada ? "‚úÖ" : "‚ùå");
      document.getElementById("armadura").textContent = "Armadura " + (jogador.armadura ? "‚úÖ" : "‚ùå");
      document.getElementById("anel").textContent = "Anel " + (jogador.anel ? "‚úÖ" : "‚ùå");
      document.getElementById("cajado").textContent = "Cajado " + (jogador.cajado ? "‚úÖ" : "‚ùå");
      document.getElementById("amuleto").textContent = "Amuleto " + (jogador.amuleto ? "‚úÖ" : "‚ùå");
      document.getElementById("botas").textContent = "Botas " + (jogador.botas ? "‚úÖ" : "‚ùå");
      document.getElementById("orbe").textContent = "Orbe " + (jogador.orbe ? "‚úÖ" : "‚ùå");
      document.getElementById("capa").textContent = "Capa " + (jogador.capa ? "‚úÖ" : "‚ùå");
      document.getElementById("coroa").textContent = "Coroa " + (jogador.coroa ? "‚úÖ" : "‚ùå");
    }

    function atualizarBotoesMagia() {
      const container = document.getElementById("magiasContainer");
      container.innerHTML = "";
      const elemento = jogador.elemento;
      const nivel = jogador.nivel;

      elemento.magias.forEach((magia, i) => {
        if (nivel >= magia.nivelMin) {
          const btn = document.createElement("button");
          btn.innerHTML = `\( {magia.nome} ( \){magia.custo}m)`;
          btn.className = elemento.cor;
          btn.onclick = () => acao(`magia${i}`);
          container.appendChild(btn);
        }
      });
    }

    function acao(tipo) {
      if (gameOver) return;
      let inimigoAtacaDepois = true;
      let msg = "";
      let dano = 0;
      let cura = 0;

      if (tipo === "atacar") {
        dano = jogador.dano + (jogador.espada ? 20 : 0) + (jogador.orbe ? 35 : 0);
        if (Math.random() < jogador.chanceCritico) { dano *= 2.3; msg = `‚öîÔ∏è CR√çTICO! `; }
        msg += `\( {jogador.nome} causou <b> \){dano}</b> de dano!`;
        inimigo.vida -= dano;
        flashEnemy = 45;
        playSound(180, 120, 'sawtooth');
        criarParticula(590, 330, '#ffcc00', 8);
      }

      else if (tipo.startsWith("magia")) {
        let idx = parseInt(tipo.replace("magia", ""));
        let magia = jogador.elemento.magias[idx];
        if (!magia || jogador.mana < magia.custo) return log("Mana insuficiente ou magia n√£o dispon√≠vel");

        jogador.mana -= magia.custo;
        dano = magia.danoBase + personagem.atributos.magia * 4.5 + (jogador.cajado ? 25 : 0);

        // Fraqueza elemental
        if (jogador.elemento.nome === inimigo.fraqueza) {
          dano *= 1.5;
          msg += " <span class='destaque'>FRAQUEZA EXPLORADA! +50%</span>";
        }

        msg += ` \( {magia.nome}! <b> \){Math.round(dano)}</b> dano`;
        inimigo.vida -= dano;
        flashEnemy = 50 + idx * 5;

        // Part√≠culas por elemento
        let corPart = {Fogo:'#ff4500', Gelo:'#add8e6', Raio:'#ffff99', Terra:'#8b7355'}[jogador.elemento.nome];
        criarParticula(590, 330, corPart, 20 + idx*5);

        // Som por elemento
        let freq = {Fogo:400, Gelo:300, Raio:800, Terra:150}[jogador.elemento.nome];
        playSound(freq, 200 + idx*30, 'triangle');

        if (magia.efeito === "congelar") inimigo.congelado = 2;
        if (magia.efeito === "imobilizar") inimigo.imobilizado = 2;
        if (magia.efeito === "veneno") inimigo.veneno = 4;
      }

      else if (tipo === "usarPocao" && jogador.pocoes > 0) {
        cura = Math.min(100, jogador.vidaMax - jogador.vida);
        jogador.vida += cura;
        jogador.pocoes--;
        msg = `üß™ Po√ß√£o! +<b>${cura}</b> vida`;
        flashPlayer = 35;
        playSound(600, 180, 'sine');
      }

      log(msg);
      atualizarHUD();

      if (inimigo.vida <= 0) {
        vitoria();
        inimigoAtacaDepois = false;
      }

      if (inimigoAtacaDepois) setTimeout(ataqueInimigo, 900);
    }

    function ataqueInimigo() {
      let def = jogador.defesa + (jogador.armadura ? 18 : 0) + (jogador.amuleto ? 10 : 0);
      let dano = Math.max(2, inimigo.ataque - def);
      if (Math.random() < 0.15) dano *= 1.5; // Cr√≠tico inimigo
      jogador.vida -= dano;
      log(`üí• \( {inimigo.nome} causou <b> \){dano}</b> de dano!`);
      flashPlayer = 35;
      playSound(120, 180, 'sawtooth');
      atualizarHUD();
      if (jogador.vida <= 0) morte();
    }

    function vitoria() {
      log(`<span class="epico">üéâ ${inimigo.nome} DESTRUIDO!</span>`);

      let xpG = 28 + Math.floor(Math.random()*25) + jogador.nivel*6;
      if (jogador.coroa) xpG = Math.floor(xpG * 1.3); // +30% XP com coroa
      let moedaG = 10 + Math.floor(Math.random()*12);
      jogador.xp += xpG;
      jogador.moedas += moedaG;
      log(`+\( {xpG} XP   + \){moedaG} moedas`);

      // Drop √©pico
      if (!jogador.orbe && Math.random() < 0.08) {
        jogador.orbe = true;
        jogador.dano +=20; jogador.defesa +=20; jogador.vidaMax +=80; jogador.manaMax +=60;
        log("<span class='epico'>üåå ORBE DO CAOS DROPADO! +20 todos stats!</span>");
      }

      let xpNec = 45 * jogador.nivel;
      if (jogador.xp >= xpNec) {
        jogador.nivel++;
        jogador.xp -= xpNec;
        jogador.vidaMax += 45;
        jogador.manaMax += 25;
        jogador.vida = jogador.vidaMax;
        jogador.mana = jogador.manaMax;
        log(`<span class="epico">‚òÖ‚òÖ‚òÖ N√çVEL ${jogador.nivel} ATINGIDO! ‚òÖ‚òÖ‚òÖ</span>`);
        playSound(900, 400, 'sawtooth');

        // Perk no level up
        let perk = prompt("Escolha seu perk de n√≠vel:\n1 - +18 Dano permanente\n2 - +22 Defesa permanente\n3 - +60 Vida M√°x + cura total\n4 - +35 Mana M√°x + +15 dano m√°gico");
        if (perk === "1") jogador.dano +=18;
        else if (perk === "2") jogador.defesa +=22;
        else if (perk === "3") { jogador.vidaMax +=60; jogador.vida = jogador.vidaMax; }
        else if (perk === "4") { jogador.manaMax +=35; personagem.atributos.magia +=4; jogador.mana = jogador.manaMax; }
        else { jogador.dano +=8; jogador.defesa +=10; log("B√¥nus padr√£o aplicado"); }
      }

      inimigo = gerarInimigo();
      atualizarHUD();
      atualizarBotoesMagia();
    }

    function morte() {
      gameOver = true;
      log(`<span class="epico">üíÄ ${jogador.nome} CAIU EM BATALHA...</span> GAME OVER`);
      document.querySelectorAll("button").forEach(b => b.disabled = true);
    }

    function salvarJogo() {
      localStorage.setItem('rpgSave', JSON.stringify(jogador));
      log("üíæ Jogo salvo com sucesso!");
    }

    function carregarJogo() {
      const save = localStorage.getItem('rpgSave');
      if (save) {
        jogador = JSON.parse(save);
        atualizarHUD();
        atualizarBotoesMagia();
        log("üìÇ Jogo carregado!");
      } else {
        log("Nenhum save encontrado.");
      }
    }

    function novoJogo() {
      if (confirm("Iniciar novo jogo? (perde o save atual)")) {
        localStorage.removeItem('rpgSave');
        initJogo(true);
      }
    }

    function abrirLoja()  { document.getElementById("loja").style.display = "block"; }
    function fecharLoja() { document.getElementById("loja").style.display = "none"; }

    function atualizarBotoesMagia() {
      const container = document.getElementById("magiasContainer");
      container.innerHTML = "";
      const elemento = jogador.elemento;
      const nivel = jogador.nivel;

      elemento.magias.forEach((magia, i) => {
        if (nivel >= magia.nivelMin) {
          const btn = document.createElement("button");
          btn.innerHTML = `\( {magia.nome} ( \){magia.custo}m)`;
          btn.className = elemento.cor;
          btn.onclick = () => acao(`magia${i}`);
          container.appendChild(btn);
        }
      });
    }

    // In√≠cio
    initJogo();
    desenhar();
  </script>
</body>
</html>